<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="PiWBL" />
  <meta name="description" content="FOI" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/glavni.css" />
  <link rel="stylesheet" href="css/pocetnaStranica.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.js"></script>
  <input type="hidden" name="smname" id="id" />
<script type="module" src="Javascript/statistika.js"></script>
<script>
  
  const dohvatiParkingSpotsZaParkingSpace = async () => {
      var idSpacea = document.getElementById("parkirniSpaceovi").value;
      const response = await fetch(
        "https://localhost:7236/api/Parking/TypeOfParkingSpotsPerParkingSpace?Id=" + idSpacea,
        {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        }
      );
      const myJson = await response.json();

      return myJson;
    };

    const dohvatiSenzore = async () => {
      var idSpacea = document.getElementById("parkirniSpaceovi").value;
      const response = await fetch('https://localhost:7236/api/Parking/SensorsForParkingSpace?Id=' + idSpacea, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson = await response.json();

      return myJson;

    }

    const dohvatiPostotke = async () => {
      var idSpacea = document.getElementById("parkirniSpaceovi").value;
      var datum = document.getElementById("datumStatitika").value;
      const response = await fetch('https://localhost:7236/api/Parking/PercentageForParkingSpace?Id=' + idSpacea + '&datum=' + datum, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson = await response.json();

      return myJson;

    }

    var myDoughnutChart_2;
    var prviChart;
    var drugiChart;
    function prikazi() {

      if(myDoughnutChart_2 != undefined)
        myDoughnutChart_2.destroy();

      if(drugiChart != undefined)
        drugiChart.destroy();

      if(prviChart != undefined)
        prviChart.destroy();

      Promise.any([dohvatiSenzore()])
        .then(podaci2 => {
          $(function () {
            var x = 0;
            prviChart = new Chart(document.getElementById("prvi"), {
              type: 'bar',
              data: {
                labels: ["Senzor ID:" + podaci2[x].snrSensorId, "Senzor ID:" + podaci2[x + 1].snrSensorId, "Senzor ID:" + podaci2[x + 2].snrSensorId, "Senzor ID:" + podaci2[x + 3].snrSensorId, "Senzor ID:" + podaci2[x + 4].snrSensorId, "Senzor ID:" + podaci2[x + 5].snrSensorId, "Senzor ID:" + podaci2[x + 6].snrSensorId, "Senzor ID:" + podaci2[x + 7].snrSensorId, "Senzor ID:" + podaci2[x + 8].snrSensorId, "Senzor ID:" + podaci2[x + 9].snrSensorId,],
                datasets: [
                  {
                    label: "Battery",
                    backgroundColor: "#3e95cd",

                    data: [podaci2[x].snrNbpsBatteryLevel, podaci2[x + 1].snrNbpsBatteryLevel, podaci2[x + 2].snrNbpsBatteryLevel, podaci2[x + 3].snrNbpsBatteryLevel, podaci2[x + 4].snrNbpsBatteryLevel, podaci2[x + 5].snrNbpsBatteryLevel, podaci2[x + 6].snrNbpsBatteryLevel, podaci2[x + 7].snrNbpsBatteryLevel, podaci2[x + 8].snrNbpsBatteryLevel, podaci2[x + 9].snrNbpsBatteryLevel,]
                  }
                ]
              },
              options: {
                legend: { display: false },
                title: {
                  display: true,
                  text: 'Prikaz 10 senzora parkirnog spacea s najslabijim baterijama'
                },
              }
            });
          })
          })

      Promise.any([dohvatiPostotke()]).then((podaci3) => {
        $(function () {
          // console.log(podaci3);
          var varijablica1;
          var varijablica2;
          var varijablica3;
          var varijablica4;
          var varijablica5;
          var varijablica6;
          var varijablica7;
          var varijablica8;
          var varijablica9;
          var varijablica10;
          var varijablica11;
          var varijablica12;
          var varijablica13;
          var varijablica14;
          var varijablica15;
          var varijablica16;
          var varijablica17;
          var varijablica18;
          var varijablica19;
          var varijablica20;
          var varijablica21;
          var varijablica22;
          var varijablica23;
          var varijablica24;
          var satiIminute1;
          var satiIminute2;
          var satiIminute3;
          var satiIminute4;
          var satiIminute5;
          var satiIminute6;
          var satiIminute7;
          var satiIminute8;
          var satiIminute9;
          var satiIminute10;
          var satiIminute11;
          var satiIminute12;
          var satiIminute13;
          var satiIminute14;
          var satiIminute15;
          var satiIminute16;
          var satiIminute17;
          var satiIminute18;
          var satiIminute19;
          var satiIminute20;
          var satiIminute21;
          var satiIminute22;
          var satiIminute23;
          var satiIminute24;
          var podaci1;
          var podaci2;
          var podaci30;
          var podaci4;
          var podaci5;
          var podaci6;
          var podaci7;
          var podaci8;
          var podaci9;
          var podaci10;
          var podaci11;
          var podaci12;
          var podaci13;
          var podaci14;
          var podaci15;
          var podaci16;
          var podaci17;
          var podaci18;
          var podaci19;
          var podaci20;
          var podaci21;
          var podaci22;
          var podaci23;
          var podaci24;
          for (var z = 0; z < 24;  z++) {
            varijablica1 = podaci3[0].pslDatetime.split("T");
            varijablica2 = podaci3[1].pslDatetime.split("T");
            varijablica3 = podaci3[2].pslDatetime.split("T");
            varijablica4 = podaci3[3].pslDatetime.split("T");
            varijablica5 = podaci3[4].pslDatetime.split("T");
            varijablica6 = podaci3[5].pslDatetime.split("T");
            varijablica7 = podaci3[6].pslDatetime.split("T");
            varijablica8 = podaci3[7].pslDatetime.split("T");
            varijablica9 = podaci3[8].pslDatetime.split("T");
            varijablica10 = podaci3[9].pslDatetime.split("T");
            varijablica11 = podaci3[10].pslDatetime.split("T");
            varijablica12 = podaci3[11].pslDatetime.split("T");
            varijablica13 = podaci3[12].pslDatetime.split("T");
            varijablica14 = podaci3[13].pslDatetime.split("T");
            varijablica15 = podaci3[14].pslDatetime.split("T");
            varijablica16 = podaci3[15].pslDatetime.split("T");
            varijablica17 = podaci3[16].pslDatetime.split("T");
            varijablica18 = podaci3[17].pslDatetime.split("T");
            varijablica19 = podaci3[18].pslDatetime.split("T");
            varijablica20 = podaci3[19].pslDatetime.split("T");
            varijablica21 = podaci3[20].pslDatetime.split("T");
            varijablica22 = podaci3[21].pslDatetime.split("T");
            varijablica23 = podaci3[22].pslDatetime.split("T");
            varijablica24 = podaci3[23].pslDatetime.split("T");
            satiIminute1 = varijablica1[1].split('.');
            satiIminute2 = varijablica2[1].split('.');
            satiIminute3 = varijablica3[1].split('.');
            satiIminute4 = varijablica4[1].split('.');
            satiIminute5 = varijablica5[1].split('.');
            satiIminute6 = varijablica6[1].split('.');
            satiIminute7 = varijablica7[1].split('.');
            satiIminute8 = varijablica8[1].split('.');
            satiIminute9 = varijablica9[1].split('.');
            satiIminute10 = varijablica10[1].split('.');
            satiIminute11 = varijablica11[1].split('.');
            satiIminute12 = varijablica12[1].split('.');
            satiIminute13 = varijablica13[1].split('.');
            satiIminute14 = varijablica14[1].split('.');
            satiIminute15 = varijablica15[1].split('.');
            satiIminute16 = varijablica16[1].split('.');
            satiIminute17 = varijablica17[1].split('.');
            satiIminute18 = varijablica18[1].split('.');
            satiIminute19 = varijablica19[1].split('.');
            satiIminute20 = varijablica20[1].split('.');
            satiIminute21 = varijablica21[1].split('.');
            satiIminute22 = varijablica22[1].split('.');
            satiIminute23 = varijablica23[1].split('.');
            satiIminute24 = varijablica24[1].split('.');
            podaci1 = podaci3[0].pslLoad;
            podaci2 = podaci3[1].pslLoad;
            podaci30 = podaci3[2].pslLoad;
            podaci4 = podaci3[3].pslLoad;
            podaci5 = podaci3[4].pslLoad;
            podaci6 = podaci3[5].pslLoad;
            podaci7 = podaci3[6].pslLoad;
            podaci8 = podaci3[7].pslLoad;
            podaci9 = podaci3[8].pslLoad;
            podaci10 = podaci3[9].pslLoad;
            podaci11 = podaci3[10].pslLoad;
            podaci12 = podaci3[11].pslLoad;
            podaci13 = podaci3[12].pslLoad;
            podaci14 = podaci3[13].pslLoad;
            podaci15 = podaci3[14].pslLoad;
            podaci16 = podaci3[15].pslLoad;
            podaci17 = podaci3[16].pslLoad;
            podaci18 = podaci3[17].pslLoad;
            podaci19 = podaci3[18].pslLoad;
            podaci20 = podaci3[19].pslLoad;
            podaci21 = podaci3[20].pslLoad;
            podaci22 = podaci3[21].pslLoad;
            podaci23 = podaci3[22].pslLoad;
            podaci24 = podaci3[23].pslLoad;
          }
            drugiChart = new Chart(document.getElementById("treci"), {
              type: 'bar',
              data: {
                labels: [satiIminute1[0], satiIminute2[0], satiIminute3[0],satiIminute4[0],satiIminute5[0],satiIminute6[0],satiIminute7[0],satiIminute8[0],satiIminute9[0],satiIminute10[0],satiIminute11[0],satiIminute12[0],satiIminute13[0],satiIminute14[0],satiIminute15[0],satiIminute16[0],satiIminute17[0],satiIminute18[0],satiIminute19[0],satiIminute20[0],satiIminute21[0],satiIminute22[0],satiIminute23[0],satiIminute24[0]],
                datasets: [
                  {
                    label: "Postotak zauzetosti parkirnih mjesta",
                    backgroundColor: "#3e95cd",
                    data: [podaci1, podaci2,podaci30,podaci4,podaci5,podaci6,podaci7,podaci8,podaci9,podaci10,podaci11,podaci12,podaci13,podaci14,podaci15,podaci16,podaci17,podaci18,podaci19,podaci20,podaci21,podaci22,podaci23,podaci24]
                  }
                ]
              },
              options: {
                legend: { display: false },
                title: {
                  display: true,
                  text: 'Postotak zauzetosti parkirnih mjesta po parkiralištu'
                },

              }
            });
        })
      });

      Promise.any([dohvatiParkingSpotsZaParkingSpace()])
      .then(datas => {
        // console.log(datas);
        var splitano = datas[0].split(";");
        console.log(splitano);
        var regularSplitano;
        var handicappedSplitano;
        var reservedSplitano;
        var taxiSplitano;
        var chargingSplitano;
        for(var i = 0; i < 5; i++){
          if(splitano[i] == "" || splitano[i] == undefined){
            break;
          } else {
            var splitanI = splitano[i].split(':');
            if(splitanI[0].localeCompare("Regular") === 0)
              regularSplitano = splitanI[1];
            else if(splitanI[0].localeCompare("Handicapped") == 0)
              handicappedSplitano = splitanI[1];
            else if(splitanI[0].localeCompare("TAXI") == 0)
              taxiSplitano = splitanI[1];
            else if(splitanI[0].localeCompare("Reserved") == 0)
              reservedSplitano = splitanI[1];
            else if(splitanI[0].localeCompare("Charging") == 0)
              chargingSplitano = splitanI[1];
          }
        }
          $(function () {
            var ctx_2 = document.getElementById("drugi").getContext('2d');
            var data_2 = {
              datasets: [{
                data: [regularSplitano, handicappedSplitano, reservedSplitano, taxiSplitano, chargingSplitano],
                backgroundColor: [
                  '#3c8dbc',
                  '#f56954',
                  '#f39c12',
                  '#f4dddd',
                  '#80D943',
                ],
              }],
              labels: [
                'Obično parking mjesto',
                'Invalidsko parking mjesto',
                'Rezervirano parking mjesto', 
                'Mjesto za TAXI',
                'Parking mjesto za punjenje',
              ]
            };

            myDoughnutChart_2 = new Chart(ctx_2, {
              type: 'doughnut',
              data: data_2,
              options: {
                responsive: false,
                maintainAspectRatio: false,
                legend: {
                  position: 'bottom',
                  labels: {
                    boxWidth: 12
                  }
                }
              }
            });


          });
      })
      .catch(error => {
        console.error("Failed to fetch")
      });
    }

</script>

  <title>Statistika</title>
</head>

<body id="tijeloPrijave">
  <div id="ovdjeNavigacija"></div>
    <script>
      if(sessionStorage.getItem("card_id") == undefined){
      var html = [
            '<div>',
            '<nav id="navigacija">',
            '<a href="index.html">POČETNA</a>',
            '<a id="trenutni" href="#">STATISTIKA</a>',
            '<a href="obrasci/prijava.html">PRIJAVA</a>',
            '<a id="trenutniRegistracija" href="obrasci/registracija.html">REGISTRACIJA</a>',
            '</nav>',
            '</div>'
          ].join('\n');
        document.getElementById("ovdjeNavigacija").innerHTML += html;
      } else {
        var html = [
            '<div>',
            '<nav id="navigacija">',
            '<a href="index.html">POČETNA</a>',
            '<a id="trenutni" href="statistika.html">STATISTIKA</a>',
            '<a href="algoritam.html">ALGORITAM</a>',
            '<a id="trenutniRegistracija" href="odjava.html">ODJAVA</a>',
            '</nav>',
            '</div>'
          ].join('\n');
        document.getElementById("ovdjeNavigacija").innerHTML += html;
      }
    </script>

  <script>
    const userAction2 = async () => {
      const response2 = await fetch('https://localhost:7236/api/Statistika/randomSenzori', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson2 = await response2.json();

      return myJson2;

    }

    const userAction = async () => {
      const response = await fetch('https://localhost:7236/api/Statistika/tipParkirnihMjesta', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson = await response.json();

      return myJson;

    }

    // Promise.any([userAction()])
    //   .then(datas => {
    //     for (var i = 0; i < datas.length; i++) {
    //       varijabla1 = datas[i].split(";");
    //       $(function () {

    //         var ctx_2 = document.getElementById("drugi").getContext('2d');
    //         var data_2 = {
    //           datasets: [{
    //             data: [varijabla1[0], varijabla1[1]],
    //             backgroundColor: [
    //               '#3c8dbc',
    //               '#f56954',
    //               '#f39c12',
    //             ],
    //           }],
    //           labels: [
    //             'Obično parking mjesto',
    //             'Invalidsko parking mjesto'
    //           ]
    //         };
    //         var myDoughnutChart_2 = new Chart(ctx_2, {
    //           type: 'doughnut',
    //           data: data_2,
    //           options: {
    //             responsive: false,
    //             maintainAspectRatio: false,
    //             legend: {
    //               position: 'bottom',
    //               labels: {
    //                 boxWidth: 12
    //               }
    //             }
    //           }
    //         });
    //       });
    //     }

      // })
      // .catch(error => {
      //   console.error("Failed to fetch")
      // });

    const userAction3 = async () => {
      const response3 = await fetch('https://localhost:7236/api/Statistika/brojSlobodnihMjestaPoParkirnomSpaceu', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson3 = await response3.json();

      return myJson3;

    }
  </script>

<div class="spaceodabir" style="display: flex; gap: 20px;padding-left: 36%; padding-bottom: 15px;">
  <div>
  <label style="
      padding-right: 10px;
      color: #b3b3b3;
      font-size: 19px;
    ">
    Odaberite parking space:
  </label>      
  <label style="
  padding-left: 30px;
  padding-right: 10px;
  padding-bottom: 10px;
  color: #b3b3b3;
  font-size: 19px;
    ">
    Odaberite datum:
</label>
  <form onsubmit="prikazi()" id="mojaForma" name="mojaForma" >
    <select name="parkingSpace" id="parkirniSpaceovi">
    </select>
  <input type="datetime-local" id="datumStatitika" name="datumStatitika"
    value="2021-01-01T00:00" style="margin-left: 15px; padding-right: 25px" />
    <input type="submit" value="Prikaži" style="width:100px;"></input>
  </form>

  </div>
  <br>
  <!-- <div>
    <label
      style="
        padding-right: 10px;
        color: #b3b3b3;
        font-size: 19px;
      "
    >
      Postotak zauzetosti parkirnog spacea:
    </label>
    <input
      type="text"
      id="postotakZauzetosti"
      name="postotakZauzetosti"
    />
  </div> -->
</div>

  <div class="container">
    <div class="klasa1">
      <canvas id="prvi" width="1425px" height="300px"></canvas>
    </div>

    <div class="klasa3">
      <canvas id="treci" width="1400px" height="300px"></canvas>
    </div>
    <div class="klasa2">
      <canvas id="drugi" width="300px" height="300px"></canvas>
    </div>

    </div>
  </div>

</body>

</html>