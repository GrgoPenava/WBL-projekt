<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
  <!-- <script type="text/javascript" src="Javascript/algoritam.js"></script> -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="PiWBL" />
  <meta name="description" content="FOI" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="css/glavni.css" />
  <link rel="stylesheet" href="css/pocetnaStranica.css" />
  <script>

    const dohvatiPostotke = async () => {
      var idSpacea = document.getElementById("parkirniSpaceovi").value;
      var datum = document.getElementById("datumStatitika").value;
      //console.log("AAAAAA",datum);
      const response = await fetch('https://localhost:7236/api/Parking/PercentageForParkingSpace?Id=' + idSpacea + '&datum=' + datum, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const myJson = await response.json();

      return myJson;

    }

    const odredeniParkingSpaceSaDatumom = async () => {
      var idSpacea = document.getElementById("parkirniSpaceovi").value;
      var datum = document.getElementById("datumStatitika").value;
      console.log(idSpacea);
      console.log(datum);
      const response = await fetch(
        "https://localhost:7236/api/MachineLearning/PercentageOfParking?id=" + idSpacea + "&datum=" + datum,
        {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        }
      );
      const myJson = await response.json();

      return myJson;
    };

    var drugiChart;
    Chart.defaults.global.defaultFontSize = 16;
    Chart.defaults.global.defaultFontColor = '#b3b3b3';
    Chart.defaults.global.defaultFontFamily = 'Helvetica';
    function prikazi() {
      if (drugiChart != undefined)
        drugiChart.destroy();

      Promise.allSettled([odredeniParkingSpaceSaDatumom()]).then(
        (parkirniSpaceovi2) => {
          $(function () {
            var park = parkirniSpaceovi2[0];
            var valueParkingSpacea = park[Object.keys(park)[1]];
            document.getElementById("postotakZauzetosti").value = valueParkingSpacea[0].pslLoad + "%";
            console.log(valueParkingSpacea[0].pslLoad);
          });
        }
      );
      Promise.any([dohvatiPostotke()]).then((podaci3) => {
        $(function () {
          // console.log(podaci3);
          var varijablica1;
          var varijablica2;
          var varijablica3;
          var varijablica4;
          var varijablica5;
          var varijablica6;
          var varijablica7;
          var varijablica8;
          var varijablica9;
          var varijablica10;
          var varijablica11;
          var varijablica12;
          var varijablica13;
          var varijablica14;
          var varijablica15;
          var varijablica16;
          var varijablica17;
          var varijablica18;
          var varijablica19;
          var varijablica20;
          var varijablica21;
          var varijablica22;
          var varijablica23;
          var varijablica24;
          var satiIminute1;
          var satiIminute2;
          var satiIminute3;
          var satiIminute4;
          var satiIminute5;
          var satiIminute6;
          var satiIminute7;
          var satiIminute8;
          var satiIminute9;
          var satiIminute10;
          var satiIminute11;
          var satiIminute12;
          var satiIminute13;
          var satiIminute14;
          var satiIminute15;
          var satiIminute16;
          var satiIminute17;
          var satiIminute18;
          var satiIminute19;
          var satiIminute20;
          var satiIminute21;
          var satiIminute22;
          var satiIminute23;
          var satiIminute24;
          var podaci1;
          var podaci2;
          var podaci30;
          var podaci4;
          var podaci5;
          var podaci6;
          var podaci7;
          var podaci8;
          var podaci9;
          var podaci10;
          var podaci11;
          var podaci12;
          var podaci13;
          var podaci14;
          var podaci15;
          var podaci16;
          var podaci17;
          var podaci18;
          var podaci19;
          var podaci20;
          var podaci21;
          var podaci22;
          var podaci23;
          var podaci24;
          for (var z = 0; z < 24; z++) {
            varijablica1 = podaci3[0].pslDatetime.split("T");
            varijablica2 = podaci3[1].pslDatetime.split("T");
            varijablica3 = podaci3[2].pslDatetime.split("T");
            varijablica4 = podaci3[3].pslDatetime.split("T");
            varijablica5 = podaci3[4].pslDatetime.split("T");
            varijablica6 = podaci3[5].pslDatetime.split("T");
            varijablica7 = podaci3[6].pslDatetime.split("T");
            varijablica8 = podaci3[7].pslDatetime.split("T");
            varijablica9 = podaci3[8].pslDatetime.split("T");
            varijablica10 = podaci3[9].pslDatetime.split("T");
            varijablica11 = podaci3[10].pslDatetime.split("T");
            varijablica12 = podaci3[11].pslDatetime.split("T");
            varijablica13 = podaci3[12].pslDatetime.split("T");
            varijablica14 = podaci3[13].pslDatetime.split("T");
            varijablica15 = podaci3[14].pslDatetime.split("T");
            varijablica16 = podaci3[15].pslDatetime.split("T");
            varijablica17 = podaci3[16].pslDatetime.split("T");
            varijablica18 = podaci3[17].pslDatetime.split("T");
            varijablica19 = podaci3[18].pslDatetime.split("T");
            varijablica20 = podaci3[19].pslDatetime.split("T");
            varijablica21 = podaci3[20].pslDatetime.split("T");
            varijablica22 = podaci3[21].pslDatetime.split("T");
            varijablica23 = podaci3[22].pslDatetime.split("T");
            varijablica24 = podaci3[23].pslDatetime.split("T");
            satiIminute1 = varijablica1[1].split('.');
            satiIminute2 = varijablica2[1].split('.');
            satiIminute3 = varijablica3[1].split('.');
            satiIminute4 = varijablica4[1].split('.');
            satiIminute5 = varijablica5[1].split('.');
            satiIminute6 = varijablica6[1].split('.');
            satiIminute7 = varijablica7[1].split('.');
            satiIminute8 = varijablica8[1].split('.');
            satiIminute9 = varijablica9[1].split('.');
            satiIminute10 = varijablica10[1].split('.');
            satiIminute11 = varijablica11[1].split('.');
            satiIminute12 = varijablica12[1].split('.');
            satiIminute13 = varijablica13[1].split('.');
            satiIminute14 = varijablica14[1].split('.');
            satiIminute15 = varijablica15[1].split('.');
            satiIminute16 = varijablica16[1].split('.');
            satiIminute17 = varijablica17[1].split('.');
            satiIminute18 = varijablica18[1].split('.');
            satiIminute19 = varijablica19[1].split('.');
            satiIminute20 = varijablica20[1].split('.');
            satiIminute21 = varijablica21[1].split('.');
            satiIminute22 = varijablica22[1].split('.');
            satiIminute23 = varijablica23[1].split('.');
            satiIminute24 = varijablica24[1].split('.');
            podaci1 = podaci3[0].pslLoad;
            podaci2 = podaci3[1].pslLoad;
            podaci30 = podaci3[2].pslLoad;
            podaci4 = podaci3[3].pslLoad;
            podaci5 = podaci3[4].pslLoad;
            podaci6 = podaci3[5].pslLoad;
            podaci7 = podaci3[6].pslLoad;
            podaci8 = podaci3[7].pslLoad;
            podaci9 = podaci3[8].pslLoad;
            podaci10 = podaci3[9].pslLoad;
            podaci11 = podaci3[10].pslLoad;
            podaci12 = podaci3[11].pslLoad;
            podaci13 = podaci3[12].pslLoad;
            podaci14 = podaci3[13].pslLoad;
            podaci15 = podaci3[14].pslLoad;
            podaci16 = podaci3[15].pslLoad;
            podaci17 = podaci3[16].pslLoad;
            podaci18 = podaci3[17].pslLoad;
            podaci19 = podaci3[18].pslLoad;
            podaci20 = podaci3[19].pslLoad;
            podaci21 = podaci3[20].pslLoad;
            podaci22 = podaci3[21].pslLoad;
            podaci23 = podaci3[22].pslLoad;
            podaci24 = podaci3[23].pslLoad;
          }
          drugiChart = new Chart(document.getElementById("treci"), {
            type: 'line',
            data: {
              labels: [satiIminute1[0], satiIminute2[0], satiIminute3[0], satiIminute4[0], satiIminute5[0], satiIminute6[0], satiIminute7[0], satiIminute8[0], satiIminute9[0], satiIminute10[0], satiIminute11[0], satiIminute12[0], satiIminute13[0], satiIminute14[0], satiIminute15[0], satiIminute16[0], satiIminute17[0], satiIminute18[0], satiIminute19[0], satiIminute20[0], satiIminute21[0], satiIminute22[0], satiIminute23[0], satiIminute24[0]],
              datasets: [
                {
                  fill: false,
                  borderColor: '#1971c2',
                  label: "Postotak zauzetosti parkirnih mjesta",
                  backgroundColor: "#3e95cd",
                  pointRadius: 5,
                  pointHoverRadius: 8,
                    data: [podaci1, podaci2, podaci30, podaci4, podaci5, podaci6, podaci7, podaci8, podaci9, podaci10, podaci11, podaci12, podaci13, podaci14, podaci15, podaci16, podaci17, podaci18, podaci19, podaci20, podaci21, podaci22, podaci23, podaci24]
                }
              ]
            },
            options: {
              legend: { display: false },
              title: {
                display: true,
                text: 'Postotak zauzetosti:'
              },

            }
          });
        })
      })
        .catch(error => {
          console.error("Failed to fetch")
        });
    }

  </script>

  <title>Parkirna mjesta</title>
</head>

<body>
  <div id="ovdjeNavigacija"></div>
  <script>
    if (sessionStorage.getItem("card_id") == undefined) {
      var html = [
        "<div>",
        '<nav id="navigacija">',
        '<a id="trenutni" href="#">POČETNA</a>',
        '<a href="statistika.html">STATISTIKA</a>',
        '<a href="obrasci/prijava.html">PRIJAVA</a>',
        '<a id="trenutniRegistracija" href="obrasci/registracija.html">REGISTRACIJA</a>',
        "</nav>",
        "</div>",
      ].join("\n");
      document.getElementById("ovdjeNavigacija").innerHTML += html;
    } else {
      var html = [
        "<div>",
        '<nav id="navigacija">',
        '<a href="index.html">POČETNA</a>',
        '<a href="statistika.html">STATISTIKA</a>',
        '<a id="trenutni" href="#">ALGORITAM</a>',
        '<a id="trenutniRegistracija" href="odjava.html">ODJAVA</a>',
        "</nav>",
        "</div>",
      ].join("\n");
      document.getElementById("ovdjeNavigacija").innerHTML += html;
    }

  </script>

  <div class="spaceodabir" style="display: flex; gap: 20px;padding-left: 36%; padding-bottom: 15px;">
    <div>
      <label style="
      padding-right: 10px;
      color: #b3b3b3;
      font-size: 19px;
    ">
        Odaberite parking space:
      </label>
      <label style="
  padding-left: 30px;
  padding-right: 10px;
  padding-bottom: 10px;
  color: #b3b3b3;
  font-size: 19px;
    ">
        Odaberite datum:
      </label>
      <form onsubmit="prikazi()" id="mojaForma" name="mojaForma">
        <select name="parkingSpace" id="parkirniSpaceovi">
        </select>
        <input type="datetime-local" id="datumStatitika" name="datumStatitika" value="2021-01-01T00:00"
          style="margin-left: 15px; padding-right: 25px;" />
        <input type="submit" value="Prikaži" style="width:100px;"></input>
      </form>
      <br>
      <label style="
    padding-right: 10px;
    color: #b3b3b3;
    font-size: 19px;
  ">
        Postotak zauzetosti parkirnog spacea:
      </label>
      <input type="text" id="postotakZauzetosti" name="postotakZauzetosti" disabled />
    </div>
  </div>
  <div class="klasa3">
    <canvas id="treci" style="padding: 0 200px;" width="1250px" height="300px"></canvas>
  </div>
  <div style="width: 50%; margin-left: 600px;">
    <canvas id="canvas" style="padding-left: 50px"></canvas>
  </div>

  <!-- <script>
      var chartColors = {
        red: "rgb(255, 99, 132)",
        orange: "rgb(255, 159, 64)",
        yellow: "rgb(255, 205, 86)",
        green: "rgb(75, 192, 192)",
        blue: "rgb(54, 162, 235)",
        purple: "rgb(153, 102, 255)",
        grey: "rgb(231,233,237)",
      };

      var MONTHS = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      var config = {
        type: "line",
        data: {
          labels: [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
          ],
          datasets: [
            {
              label: "My First dataset",
              backgroundColor: chartColors.red,
              borderColor: chartColors.red,
              data: [300, 100, 200, 500],
              fill: false,
            },
            {
              label: "My Second dataset",
              fill: false,
              backgroundColor: chartColors.blue,
              borderColor: chartColors.blue,
              data: [600, 300, 100, 200, 500],
            },
          ],
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: "Chart.js Line Chart",
          },
          tooltips: {
            mode: "label",
          },
          hover: {
            mode: "nearest",
            intersect: true,
          },
          scales: {
            xAxes: [
              {
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: "Month",
                },
              },
            ],
            yAxes: [
              {
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: "Value",
                },
              },
            ],
          },
        },
      };

      var ctx = document.getElementById("canvas").getContext("2d");
      window.myLine = new Chart(ctx, config);
    </script> -->


  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <script type="text/javascript" src="Javascript/algoritam.js"></script>
</body>

</html>